x<-data.frame('answer'=recog,count=rep(1,length(recog)))
unique(x$answer)
sum.recog<-x%>%group_by(answer)%>%dplyr::summarise(counts=sum(count))
sum.recog
data
head(data,1)
sum.recog<-data.frame(sum.recog,sum.recog$counts/nrow(data))
sum.recog
round(sum.recog$counts/nrow(data)*100,0)
sum.recog<-data.frame(sum.recog,'percentage'=round(sum.recog$counts/nrow(data)*100,0))
sum.recog
sum.recog<-data.frame('hcp.major'=j,sum.recog,'percentage'=round(sum.recog$counts/nrow(data)*100,0))
sum.recog
recog<-unlist(strsplit(data$answers,';'))
x<-data.frame('answer'=recog,count=rep(1,length(recog)))
sum.recog<-x%>%group_by(answer)%>%dplyr::summarise(counts=sum(count))
sum.recog<-data.frame('hcp.major'=j,sum.recog,'percentage'=round(sum.recog$counts/nrow(data)*100,0))
sum.recog}
recog.tr<-function(data,j){
data<-data[data$hcp.major==j,]
head(data,1)
recog<-unlist(strsplit(data$answers,';'))
x<-data.frame('answer'=recog,count=rep(1,length(recog)))
sum.recog<-x%>%group_by(answer)%>%dplyr::summarise(counts=sum(count))
sum.recog<-data.frame('hcp.major'=j,sum.recog,'percentage'=round(sum.recog$counts/nrow(data)*100,0))
sum.recog}
recog.tr(data,j)
rbind(recog.tr(data,1),
recog.tr(data,2),
recog.tr(data,3))
recog.tr(data,2)
rbind(recog.tr(data,1.0),
recog.tr(data,2.0),
recog.tr(data,3.0))
recog.tr(data,2.0)
rbind(recog.tr(data,'1.0'),
recog.tr(data,'2.0'),
recog.tr(data,'3.0'))
recog.tr(data,'1.0')
recog.tr(data,'2.0')
data,'1.0'
data
unique(data$hcp.major)
data<-p14_tmp1[p14_tmp1$date==i,]
rbind(recog.tr(data,'1.0'),
recog.tr(data,'2.0'),
recog.tr(data,'3.0'))
data$hcp.major=='4.0'
unique(data$hcp.major)=='4.0'
'4.0'%in%unique(data$hcp.major)
'1.0'%in%unique(data$hcp.major)
recog.tr(data,'1.0')$answer
recog.tr(data,'1.0')
if ('1.0' %in% unique(data$hcp.major))
{recog.tr(data,'1.0')}
if ('4.0' %in% unique(data$hcp.major))
{recog.tr(data,'1.0')
} else{
data.frame('hcp.major'=j,'answer'=recog.tr(data,'1.0')$answer,'counts'=0,
'percentage'=0)}
recog.tr(data,'1.0')$answer
p14_tmp2 <- rbind(recog.tr(data, '1.0'),
recog.tr(data, '2.0'),
recog.tr(data, '3.0'))
p14_tmp2
p <- ggplot(data=p14_tmp2,aes(x=factor(hcp.major),y=percentage,group=answer,colour=answer)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
p
View(p14_tmp2)
recog.tr<-function(data){
recog <- unlist(strsplit(data$answers, ';'))
x <- data.frame('answer' = recog, count = rep(1, length(recog)))
sum.recog <-
x %>% group_by(answer) %>% dplyr::summarise(counts = sum(count))
sum.recog <-
data.frame(
sum.recog$answer,
'percentage' = round(sum.recog$counts / nrow(data) * 100, 0
)
)
sum.recog
}
head(p14_tmp2,1)
head(p14_tmp1,1)
p14_tmp2<-p14_tmp2%>%group_by(hcp.major)%>%summarise(recog.tr(answers))
p14_tmp2<-p14_tmp2%>%group_by(hcp.major)%>%summarise(recog.tr(answer))
recog.tr<-function(data){
recog <- unlist(strsplit(data$answer, ';'))
x <- data.frame('answer' = recog, count = rep(1, length(recog)))
sum.recog <-
x %>% group_by(answer) %>% dplyr::summarise(counts = sum(count))
sum.recog <-
data.frame(
'hcp.major' = 'ALL',
sum.recog$answer,
'percentage' = round(sum.recog$counts / nrow(data) * 100, 0
)
)
sum.recog
}
recog.tr<-function(data){
recog <- unlist(strsplit(data$answer, ';'))
x <- data.frame('answer' = recog, count = rep(1, length(recog)))
sum.recog <-
x %>% group_by(answer) %>% dplyr::summarise(counts = sum(count))
sum.recog <-
data.frame(
'hcp.major' = 'ALL',
sum.recog$answer,
'percentage' = round(sum.recog$counts / nrow(data) * 100, 0
)
)
sum.recog
}
recog.dis.tr <- function(data, j) {
if (j %in% unique(data$hcp.major)      )
{
data <- data[data$hcp.major == j, ]
tmp<-recog.tr(data)
sum.recog <-
data.frame('hcp.major' = j,
tmp$answer,
tmp$percentage
)
} else{
sum.recog <- data.frame(
'hcp.major' = j,
'answer' = answers,
'percentage' = 0
)
}
sum.recog
}
recog.tr(data)
recog.dis.tr(data, '1.0')
recog.tr<-function(data){
recog <- unlist(strsplit(data$answer, ';'))
x <- data.frame('answer' = recog, count = rep(1, length(recog)))
sum.recog <-
x %>% group_by(answer) %>% dplyr::summarise(counts = sum(count))
sum.recog <-
data.frame(
'hcp.major' = 'ALL',
'answer'=sum.recog$answer,
'percentage' = round(sum.recog$counts / nrow(data) * 100, 0
)
)
sum.recog
}
recog.dis.tr <- function(data, j) {
if (j %in% unique(data$hcp.major)      )
{
data <- data[data$hcp.major == j, ]
tmp<-recog.tr(data)
sum.recog <-
data.frame('hcp.major' = j,
tmp$answer,
tmp$percentage
)
} else{
sum.recog <- data.frame(
'hcp.major' = j,
'answer' = answers,
'percentage' = 0
)
}
sum.recog
}
recog.dis.tr(data, '1.0')
recog.tr(data)
x<-tbl_df(p10_tmp2) %>%
group_by(date) %>%
dplyr::summarize(counts=n_distinct(doctor.id))
View(x)
x<-seperate_rows(p14_tmp1,sep';')
df <- data.frame(
x = 1:3,
y = c("a", "d,e,f", "g,h"),
z = c("1", "2,3,4", "5,6"),
stringsAsFactors = FALSE
)
df
separate_rows(df, y, z, convert = TRUE)
library(tidyr)
separate_rows(df, y, z, convert = TRUE)
separate_rows(df, y, z, convert = F)
x<-seperate_rows(p14_tmp1,answer,sep=';')
x<-seperate_row(p14_tmp1,answer,sep=';')
x<-separate_rows(p14_tmp1,answer,sep=';')
x<-separate_rows(p14_tmp1,answers,sep=';')
View(x)
i<-as.yearmon('2016-08')
View(x)
p14_tmp2<-p14_tmp2%>%group_by(date,hcp.major,answers)%>%summarise(n())
p14_tmp1<-separate_rows(p14_tmp1,answers,sep=';')
p14_tmp2<-p14_tmp1%>%group_by(date,hcp.major,answers)%>%summarise(n())
p14_tmp2<-p14_tmp1%>%group_by(date,hcp.major,answers)%>%dplyr::summarise(counts=n())
View(p14_tmp2)
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(counts=n())
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(total=n())
x<-merge(p14_tmp2,summ)
View(x)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
p14_tmp1<-data.frame(eda_dat[grep('Q15',eda_dat$questions),c(1,5,7,11)])
p14_tmp1<-data.frame('date'=as.yearmon(p14_tmp1$most.recent.modify.date),p14_tmp1)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
p14_tmp2<-p14_tmp2%>%group_by(date,hcp.major,answers)%>%dplyr::summarise(counts=n())
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(total=n())
x<-merge(p14_tmp2,summ)
View(x)
View(x)
p14_tmp3<-data.frame(x,x$counts/x$total)
View(p14_tmp3)
p14_tmp3<-data.frame(x,'percentage'=round(x$counts/x$total*100,0))
View(p14_tmp3)
View(p14_tmp3)
View(p14_tmp2)
total<-p14_tmp2%>%group_by(date,answers,'hcp.major')%>%summarise(counts=sum(counts))
View(total)
View(p14_tmp2)
total<-p14_tmp2%>%group_by(date,answers)%>%summarise(counts=sum(counts))
View(total)
total<-p14_tmp2%>%group_by(date,answers,'hcp.major')%>%dplyr::summarise(counts=sum(counts))
View(total)
total%`hcp.major`
total$`hcp.major`
View(total)
total$`"hcp.major"`
colnames(total)[3]<-'hcp.major'
total$hcp.major
total$hcp.major<'All'
total$hcp.major<-'All'
total
View(total)
rbind(p14_tmp3,total)
rbind(p14_tmp2,total)
x<-rbind(p14_tmp2,total)
View(x)
date(x$date)
as.Date(x$date, origin = "1899-12-30")
as.Date(x$date, origin = "2016-06")
View(p14_tmp2)
colnames(p14_tmp2)
View(p14_tmp1)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
colnames(p14_tmp2)
p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct())
p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid))
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid))
View(chk)
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
counts=sum(.$counts, na.rm=T))))
View(chk)
total
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
answers=first(x$answers),
counts=sum(.$counts, na.rm=T))))
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
answers=first(.$answers),
counts=sum(.$counts, na.rm=T),
stringsAsFactors=F)))
View(chk)
colnames(p14_tmp2)
warnings(0)
p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid))
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
answers=first(.$answers),
counts=sum(.$counts))))
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
View(chk)
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts),
stringsAsFactors = F)))
View(chk)
chk <- p14_tmp2 %>%
group_by(date, hcp.major, answers) %>%
dplyr::summarize(counts = n_distinct(doctorid))
View(chk)
chk <- p14_tmp2 %>%
group_by(date,  answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid))
View(chk)
chk <- p14_tmp2 %>%
group_by(date,  answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts),
stringsAsFactors = FALSE)))
View(chk)
chk <- p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
chk <- p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid))
str(chk)
chk <- p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = as.yearmon(first(.$date)),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
p14_tmp1<-data.frame('date'=factor(as.yearmon(p14_tmp1$most.recent.modify.date)),p14_tmp1)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
chk <- p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
View(summ)
p14_tmp2<-p14_tmp2%>%p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
p14_tmp2<-p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
p14_tmp2<-p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
p14_tmp1<-data.frame(eda_dat[grep('Q15',eda_dat$questions),c(1,5,7,11)])
p14_tmp1<-data.frame('date'=factor(as.yearmon(p14_tmp1$most.recent.modify.date)),p14_tmp1)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
p14_tmp2<-p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(total=n())
p14_tmp3<-data.frame(merge(p14_tmp2,summ),'percentage'=round(x$counts/x$total*100,0))
merge(p14_tmp2,summ)
tmp<-merge(p14_tmp2,summ)
p14_tmp3<-data.frame(tmp,'percentage'=round(tmp$counts/tmp$total*100,0))
ggplot(data=p14_tmp3,aes(x=hcp.major,y=percentage,group=hcp.major,colour=hcp.major)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=hcp.major,y=percentage,group=answer,colour=hcp.major)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=hcp.major,y=percentage,group=answers,colour=hcp.major)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=hcp.major,y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
View(p14_tmp3)
summ
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(total=n())%>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
total=sum(.$total))))
summ
tmp<-merge(p14_tmp2,summ)
p14_tmp3<-data.frame(tmp,'percentage'=round(tmp$counts/tmp$total*100,0))
ggplot(data=p14_tmp3,aes(x=hcp.major,y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=factor(hcp.major),y=percentage,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=factor(hcp.major),y=percentage,group=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3,aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
View(p14_tmp3)
p14_tmp3<-data.frame(tmp[,-1],'percentage'=round(tmp$counts/tmp$total*100,0))
ggplot(data=p14_tmp3,aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
View(p14_tmp3)
p14_tmp3<-data.frame(tmp,'percentage'=round(tmp$counts/tmp$total*100,0))
ggplot(data=p14_tmp3[p14_tmp3$date=='7月 2016'，],aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
ggplot(data=p14_tmp3[p14_tmp3$date=='7月 2016',],aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
View(p14_tmp3)
p14_tmp1<-data.frame(eda_dat[grep('Q16',eda_dat$questions),c(1,5,7,11)])
p14_tmp1<-data.frame('date'=factor(as.yearmon(p14_tmp1$most.recent.modify.date)),p14_tmp1)
p14_tmp2<-separate_rows(p14_tmp1,answers,sep=';')
p14_tmp2<-p14_tmp2 %>%
group_by(date,answers, hcp.major) %>%
dplyr::summarize(counts = n_distinct(doctorid)) %>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
answers=first(.$answers),
hcp.major = c("All"),
counts=sum(.$counts))))
summ<-p14_tmp1%>%group_by(date,hcp.major)%>%dplyr::summarise(total=n())%>%
do(plyr::rbind.fill(., data_frame(date = first(.$date),
hcp.major = c("All"),
total=sum(.$total))))
tmp<-merge(p14_tmp2,summ)
p14_tmp3<-data.frame(tmp,'percentage'=round(tmp$counts/tmp$total*100,0))
ggplot(data=p14_tmp3[p14_tmp3$date=='7月 2016',],aes(x=factor(hcp.major),y=percentage,group=answers,colour=answers)) +
geom_line() +  geom_point() +
theme(legend.title = element_blank(),legend.position = 'top')
as.numeric("1.0")
p15_tmp1<-eda_dat[,c(1,5,9,10,13)]
p15_tmp1<-data.frame('date'=as.character(as.yearmon(p14_tmp1$most.recent.modify.date)),p15_tmp1)
p15_tmp1<-data.frame('date'=as.character(as.yearmon(p15_tmp1$most.recent.modify.date)),p15_tmp1)
View(p15_tmp1)
p15_tmp1<-eda_dat[,c(1,5,7,9,10,13)]
p15_tmp1<-data.frame('date'=as.character(as.yearmon(p15_tmp1$most.recent.modify.date)),p15_tmp1)
View(p15_tmp1)
p15_tmp1$hcp.major<-as.numeric(p15_tmp1$hcp.major)
data<- p15_tmp1%>% group_by(date,doctorid) %>%
dplyr::summarise(change=(hcp.major[which(date==max(date))]-hcp.major[which(date==max(date))]))
View(p15_tmp1)
max(p15_tmp1$date)
p15_tmp1<-eda_dat[,c(1,5,7,9,10,13)]
p15_tmp1<-data.frame('date'=as.yearmon(p15_tmp1$most.recent.modify.date),p15_tmp1)
max(p15_tmp1$date)
data<-p15_tmp1 %>% group_up(date,doctorid)
data<-p15_tmp1 %>% group_by(date,doctorid)%>%
dplyr::summarise(most.recent.modify.date=max(most.recent.modify.date))
merge(data,p15_tmp1)
warnings90
warnings()
head(p15_tmp1,1)
p15_tmp1<-eda_dat[,c(1,5,7,9,10,13)]
p15_tmp1<-eda_dat[,c(1,5,7,9,10,13)]
eda_dat <- read.xlsx("./02_Inputs/EDAData201707.xlsx",
sheet = "Raw Data",detectDates=T)
colnames(eda_dat)[c(4, 5, 6, 10, 11)] <-
c("questionare.id", "most.recent.modify.date", "survey.name", "questions",
"answers")
colnames(eda_dat) <- tolower(colnames(eda_dat))
eda_dat$most.recent.modify.date <-
as.Date(eda_dat$most.recent.modify.date, origin = "1899-12-30")
p15_tmp1<-eda_dat[,c(1,5,7,9,10,13)]
p15_tmp1<-data.frame('date'=as.yearmon(p15_tmp1$most.recent.modify.date),p15_tmp1)
data<-p15_tmp1 %>% group_by(date,doctorid)%>%
dplyr::summarise(most.recent.modify.date=max(most.recent.modify.date))
head(p15_tmp1,1)
head(data,1)
newdata<-merge(data,p15_tmp1)
warnings()
newdata<-merge(p15_tmp1,data)
newdata<-merge(p15_tmp1,data,by=c('date','doctorid','most.recent.modify.date'))
newdata<-merge(p15_tmp1,data,by=c('date','doctorid','most.recent.modify.date'))
head(newdata)
head(newdata,1)
columnames(newdata)
colnames(newdata)
which(is.na(newdata$hcp.major))
warnings()
head(data,1)
head(p15_tmp1,1)
